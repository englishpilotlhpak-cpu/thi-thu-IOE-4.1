<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BỘ ĐỀ ÔN IOE K4 SỐ: 01.1</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap');
        body {
            font-family: 'Baloo 2', cursive;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .word-block {
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        audio {
            filter: sepia(20%) saturate(70%) grayscale(1) contrast(99%) brightness(90%);
        }
    </style>
</head>
<body class="bg-blue-50 font-sans antialiased text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        // --- DỮ LIỆU CÂU HỎI IOE LỚP 4 (ĐỀ SỐ 01.1) - 100 CÂU ---
        const questions = [
            {
                type: 'rearrange',
                question: '1. pictures/ in the classroom./ There are/ eight/',
                words: ['There are', 'eight', 'pictures', 'in the classroom.'],
                correctAnswer: 'There are eight pictures in the classroom.',
                correctAnswer_vi: 'Có tám bức tranh trong lớp học.',
                hint_vi: 'Bắt đầu với "There are".',
                rationale_vi: 'Cấu trúc "There are" dùng để chỉ sự tồn tại của danh từ số nhiều (eight pictures).',
                rationale_en: 'The structure "There are" is used to indicate the existence of plural nouns (eight pictures).'
            },
            {
                type: 'multimedia',
                question: '2. The book is ____ that chair.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/22/635207253574272906_566X320.jpg',
                correctAnswer: 'under',
                correctAnswer_vi: 'dưới',
                hint_vi: 'Nhìn vị trí của cuốn sách so với cái ghế. (5 ký tự)',
                rationale_vi: 'Trong hình, cuốn sách đang ở bên dưới (under) cái ghế.',
                rationale_en: 'In the picture, the book is under the chair.'
            },
            {
                type: 'fill-in-the-blank',
                question: '3. This is a re_ crayon.',
                correctAnswer: 'd',
                correctAnswer_vi: 'd',
                hint_vi: 'Từ chỉ màu đỏ. (1 ký tự)',
                rationale_vi: 'Từ đúng là "red" (màu đỏ).',
                rationale_en: 'The correct word is "red".'
            },
            {
                type: 'mc',
                question: '4. What is your favourite …? – Lemonade.',
                options: [
                    { text: 'A. food', isCorrect: false },
                    { text: 'B. drink', isCorrect: true },
                    { text: 'C. fruit', isCorrect: false },
                    { text: 'D. colour', isCorrect: false }
                ],
                correctAnswer: 'B. drink',
                correctAnswer_vi: 'đồ uống',
                hint_vi: 'Lemonade (nước chanh) là một loại gì?',
                rationale_vi: 'Lemonade (nước chanh) là một loại đồ uống (drink).',
                rationale_en: 'Lemonade is a type of drink.'
            },
            {
                type: 'fill-in-the-blank',
                question: '5. There are four peo__e in my family.',
                correctAnswer: 'pl',
                correctAnswer_vi: 'pl',
                hint_vi: 'Từ có nghĩa là "người". (2 ký tự)',
                rationale_vi: 'Từ đúng là "people" (người).',
                rationale_en: 'The correct word is "people".'
            },
            {
                type: 'multimedia',
                question: '6. I have ___ books.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790677578900928_Audio.mp3',
                correctAnswer: 'six',
                correctAnswer_vi: 'sáu',
                hint_vi: 'Nghe và điền số lượng sách. (3 ký tự)',
                rationale_vi: 'Bài nghe nói "I have six books" (Tôi có sáu quyển sách).',
                rationale_en: 'The audio says "I have six books".'
            },
            {
                type: 'mc',
                question: '7. John learns to sing … Music lessons.',
                options: [
                    { text: 'A. from', isCorrect: false },
                    { text: 'B. during', isCorrect: true },
                    { text: 'C. at', isCorrect: false },
                    { text: 'D. to', isCorrect: false }
                ],
                correctAnswer: 'B. during',
                correctAnswer_vi: 'trong suốt',
                hint_vi: 'Giới từ chỉ thời gian.',
                rationale_vi: '"During" có nghĩa là "trong suốt" một khoảng thời gian hoặc một sự kiện (Music lessons).',
                rationale_en: '"During" means "throughout the course or duration of" an event (Music lessons).'
            },
            {
                type: 'fill-in-the-blank',
                question: '8. Remember to drink water everyday. It’s good ___ our health.',
                correctAnswer: 'for',
                correctAnswer_vi: 'cho',
                hint_vi: 'Cụm từ "tốt cho". (3 ký tự)',
                rationale_vi: 'Cụm từ "good for" có nghĩa là "tốt cho" cái gì đó.',
                rationale_en: 'The phrase "good for" means beneficial for something.'
            },
            {
                type: 'fill-in-the-blank',
                question: '9. A: What’s your ___by? - B: I like playing hide-and-seek with my friends.',
                correctAnswer: 'hob',
                correctAnswer_vi: 'sở thích',
                hint_vi: 'Từ có nghĩa là "sở thích". (3 ký tự)',
                rationale_vi: 'Từ đúng là "hobby" (sở thích).',
                rationale_en: 'The correct word is "hobby".'
            },
            {
                type: 'rearrange',
                question: '10. Is/ today? – No,/ Saturday./ it Sunday/ it’s/',
                words: ['Is it Sunday', 'today? – No,', 'it’s Saturday.'],
                correctAnswer: 'Is it Sunday today? – No, it’s Saturday.',
                correctAnswer_vi: 'Hôm nay là Chủ nhật phải không? - Không, hôm nay là thứ Bảy.',
                hint_vi: 'Một đoạn hội thoại ngắn.',
                rationale_vi: 'Đây là một câu hỏi Yes/No và câu trả lời về ngày trong tuần.',
                rationale_en: 'This is a Yes/No question and answer about the day of the week.'
            },
            {
                type: 'mc',
                question: '11. This is John. He’s my ... .',
                options: [
                    { text: 'A. sister', isCorrect: false },
                    { text: 'B. mother', isCorrect: false },
                    { text: 'C. toy', isCorrect: false },
                    { text: 'D. brother', isCorrect: true }
                ],
                correctAnswer: 'D. brother',
                correctAnswer_vi: 'anh trai/em trai',
                hint_vi: 'John là tên con trai.',
                rationale_vi: 'Vì "He" (anh ấy) được sử dụng, từ cần điền phải là một danh từ chỉ nam giới. "brother" là lựa chọn hợp lý.',
                rationale_en: 'Since "He" is used, the word must be a male noun. "brother" is the logical choice.'
            },
            {
                type: 'fill-in-the-blank',
                question: '12. There are many books o_ the bookshelf.',
                correctAnswer: 'n',
                correctAnswer_vi: 'n',
                hint_vi: 'Giới từ chỉ vị trí "trên". (1 ký tự)',
                rationale_vi: 'Giới từ "on" được dùng để chỉ vật gì đó ở trên một bề mặt.',
                rationale_en: 'The preposition "on" is used to indicate that something is on a surface.'
            },
            {
                type: 'mc',
                question: '13. Choose the odd one out.',
                options: [
                    { text: 'A. Post office', isCorrect: false },
                    { text: 'B. Bank', isCorrect: false },
                    { text: 'C. Bakery', isCorrect: false },
                    { text: 'D. Picnic', isCorrect: true }
                ],
                correctAnswer: 'D. Picnic',
                correctAnswer_vi: 'Chuyến dã ngoại',
                hint_vi: 'Tìm từ không phải là một địa điểm.',
                rationale_vi: '"Post office", "Bank", và "Bakery" là các địa điểm. "Picnic" là một hoạt động.',
                rationale_en: '"Post office", "Bank", and "Bakery" are places. "Picnic" is an activity.'
            },
            {
                type: 'fill-in-the-blank',
                question: '14. Please gi__ me some more sugar.',
                correctAnswer: 've',
                correctAnswer_vi: 've',
                hint_vi: 'Từ có nghĩa là "đưa". (2 ký tự)',
                rationale_vi: 'Từ đúng là "give" (đưa, cho).',
                rationale_en: 'The correct word is "give".'
            },
            {
                type: 'rearrange',
                question: '15. How/ your/ brother?/ old/ is/',
                words: ['How old', 'is', 'your', 'brother?'],
                correctAnswer: 'How old is your brother?',
                correctAnswer_vi: 'Anh trai của bạn bao nhiêu tuổi?',
                hint_vi: 'Câu hỏi về tuổi.',
                rationale_vi: 'Cấu trúc câu hỏi tuổi: How old + is/are + S?',
                rationale_en: 'Question structure for age: How old + is/are + S?'
            },
            {
                type: 'mc',
                question: '16. Choose the odd one out:',
                options: [
                    { text: 'A. Football', isCorrect: true },
                    { text: 'B. Maths', isCorrect: false },
                    { text: 'C. Arts', isCorrect: false },
                    { text: 'D. Music', isCorrect: false }
                ],
                correctAnswer: 'A. Football',
                correctAnswer_vi: 'Bóng đá',
                hint_vi: 'Tìm từ không phải là môn học.',
                rationale_vi: '"Maths", "Arts", và "Music" là các môn học. "Football" là một môn thể thao.',
                rationale_en: '"Maths", "Arts", and "Music" are school subjects. "Football" is a sport.'
            },
            {
                type: 'rearrange',
                question: '17. meet/ It’s/ nice/ to/ you./',
                words: ['It’s', 'nice', 'to', 'meet', 'you.'],
                correctAnswer: 'It’s nice to meet you.',
                correctAnswer_vi: 'Rất vui được gặp bạn.',
                hint_vi: 'Một câu chào hỏi thông dụng.',
                rationale_vi: 'Đây là câu chào hỏi tiêu chuẩn khi gặp ai đó lần đầu.',
                rationale_en: 'This is a standard greeting when meeting someone for the first time.'
            },
            {
                type: 'rearrange',
                question: '18. school is Greenfield/ of my/ Primary/ School./ The name/',
                words: ['The name', 'of my', 'school is', 'Greenfield', 'Primary School.'],
                correctAnswer: 'The name of my school is Greenfield Primary School.',
                correctAnswer_vi: 'Tên trường của tôi là Trường Tiểu học Greenfield.',
                hint_vi: 'Bắt đầu với "The name".',
                rationale_vi: 'Cấu trúc giới thiệu tên trường: The name of my school is + [Tên trường].',
                rationale_en: 'Structure to introduce a school\'s name: The name of my school is + [School Name].'
            },
            {
                type: 'mc',
                question: '19. Choose the odd one out:',
                options: [
                    { text: 'A. you', isCorrect: true },
                    { text: 'B. father', isCorrect: false },
                    { text: 'C. mother', isCorrect: false },
                    { text: 'D. sister', isCorrect: false }
                ],
                correctAnswer: 'A. you',
                correctAnswer_vi: 'bạn',
                hint_vi: 'Tìm từ không phải là thành viên gia đình.',
                rationale_vi: '"father", "mother", và "sister" là các thành viên trong gia đình. "you" là một đại từ.',
                rationale_en: '"father", "mother", and "sister" are family members. "you" is a pronoun.'
            },
            {
                type: 'multimedia',
                question: '20. It’s a ___.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D4_13.jpg',
                options: [
                    { text: 'A. penguin', isCorrect: false },
                    { text: 'B. brown bear', isCorrect: true },
                    { text: 'C. crocodile', isCorrect: false },
                    { text: 'D. lion', isCorrect: false }
                ],
                correctAnswer: 'B. brown bear',
                correctAnswer_vi: 'con gấu nâu',
                hint_vi: 'Nhìn con vật trong hình.',
                rationale_vi: 'Hình ảnh cho thấy một con gấu nâu (brown bear).',
                rationale_en: 'The image shows a brown bear.'
            },
            {
                type: 'multimedia',
                question: '21. Spiders hear by using ____ on their legs.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790677842651515_Audio.mp3',
                correctAnswer: 'hairs',
                correctAnswer_vi: 'lông',
                hint_vi: 'Nghe và điền bộ phận cơ thể. (5 ký tự)',
                rationale_vi: 'Bài nghe giải thích rằng nhện nghe bằng những sợi lông (hairs) trên chân của chúng.',
                rationale_en: 'The audio explains that spiders hear using hairs on their legs.'
            },
            {
                type: 'fill-in-the-blank',
                question: '22. A: Which m____ is your birthday? - B: It’s in July.',
                correctAnswer: 'onth',
                correctAnswer_vi: 'onth',
                hint_vi: 'Từ có nghĩa là "tháng". (4 ký tự)',
                rationale_vi: 'Từ đúng là "month" (tháng).',
                rationale_en: 'The correct word is "month".'
            },
            {
                type: 'fill-in-the-blank',
                question: '23. Let’s dr__ a picture of a cat.',
                correctAnswer: 'aw',
                correctAnswer_vi: 'aw',
                hint_vi: 'Từ có nghĩa là "vẽ". (2 ký tự)',
                rationale_vi: 'Từ đúng là "draw" (vẽ).',
                rationale_en: 'The correct word is "draw".'
            },
            {
                type: 'mc',
                question: '24. How often do you have Science? – I have it ___ a week.',
                options: [
                    { text: 'A. twice', isCorrect: true },
                    { text: 'B. one times', isCorrect: false },
                    { text: 'C. two times', isCorrect: false },
                    { text: 'D. three time', isCorrect: false }
                ],
                correctAnswer: 'A. twice',
                correctAnswer_vi: 'hai lần',
                hint_vi: 'Cách nói "hai lần".',
                rationale_vi: '"twice" là cách nói đúng cho "hai lần". "one times" sai, phải là "once". "two times" có thể chấp nhận nhưng "twice" phổ biến hơn. "three time" sai, phải là "three times".',
                rationale_en: '"twice" is the correct way to say "two times". "one times" is incorrect; it should be "once". "two times" is acceptable, but "twice" is more common. "three time" is incorrect; it should be "three times".'
            },
            {
                type: 'multimedia',
                question: '25. We need some ______ for the dish.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636162022405539929_566X320.jpg',
                correctAnswer: 'onions',
                correctAnswer_vi: 'hành tây',
                hint_vi: 'Một loại củ dùng để nấu ăn. (6 ký tự)',
                rationale_vi: 'Trong hình là những củ hành tây (onions).',
                rationale_en: 'The picture shows onions.'
            },
            {
                type: 'rearrange',
                question: '26. Science/ class?/ is/ the next/ When/',
                words: ['When', 'is', 'the next', 'Science class?'],
                correctAnswer: 'When is the next Science class?',
                correctAnswer_vi: 'Khi nào có tiết Khoa học tiếp theo?',
                hint_vi: 'Câu hỏi về thời gian.',
                rationale_vi: 'Cấu trúc câu hỏi với "When": When + is/are + S?',
                rationale_en: 'Question structure with "When": When + is/are + S?'
            },
            {
                type: 'rearrange',
                question: '27. Phong’s/ Do you/ date of/ know/ birth?/',
                words: ['Do you', 'know', 'Phong’s', 'date of birth?'],
                correctAnswer: 'Do you know Phong’s date of birth?',
                correctAnswer_vi: 'Bạn có biết ngày sinh của Phong không?',
                hint_vi: 'Câu hỏi Yes/No.',
                rationale_vi: '"date of birth" là một cụm danh từ có nghĩa là "ngày sinh".',
                rationale_en: '"date of birth" is a noun phrase meaning the day someone was born.'
            },
            {
                type: 'rearrange',
                question: '28. Sydney,/ Australia./ Her school/ is/ in/',
                words: ['Her school', 'is', 'in', 'Sydney,', 'Australia.'],
                correctAnswer: 'Her school is in Sydney, Australia.',
                correctAnswer_vi: 'Trường của cô ấy ở Sydney, Úc.',
                hint_vi: 'Câu nói về địa điểm.',
                rationale_vi: 'Cấu trúc câu: S + V + giới từ chỉ nơi chốn + địa điểm.',
                rationale_en: 'Sentence structure: S + V + preposition of place + location.'
            },
            {
                type: 'mc',
                question: '29. How many syllables are there in the word “COMPUTER”?',
                options: [
                    { text: 'A. two', isCorrect: false },
                    { text: 'B. three', isCorrect: true },
                    { text: 'C. four', isCorrect: false },
                    { text: 'D. five', isCorrect: false }
                ],
                correctAnswer: 'B. three',
                correctAnswer_vi: 'ba',
                hint_vi: 'Đếm số âm tiết: Com-pu-ter.',
                rationale_vi: 'Từ "Computer" có 3 âm tiết: Com-pu-ter.',
                rationale_en: 'The word "Computer" has 3 syllables: Com-pu-ter.'
            },
            {
                type: 'mc',
                question: '30. How ... robots are there? - There are three robots.',
                options: [
                    { text: 'A. many', isCorrect: true },
                    { text: 'B. much', isCorrect: false },
                    { text: 'C. any', isCorrect: false },
                    { text: 'D. very', isCorrect: false }
                ],
                correctAnswer: 'A. many',
                correctAnswer_vi: 'nhiều',
                hint_vi: 'Câu hỏi về số lượng của danh từ đếm được.',
                rationale_vi: '"How many" dùng để hỏi về số lượng của danh từ đếm được (robots).',
                rationale_en: '"How many" is used to ask about the quantity of countable nouns (robots).'
            },
            {
                type: 'rearrange',
                question: '31. can/ sister/ French./ My/ speak/',
                words: ['My sister', 'can speak', 'French.'],
                correctAnswer: 'My sister can speak French.',
                correctAnswer_vi: 'Chị gái tôi có thể nói tiếng Pháp.',
                hint_vi: 'Câu khẳng định với "can".',
                rationale_vi: 'Cấu trúc câu với động từ khuyết thiếu "can": S + can + V(nguyên mẫu).',
                rationale_en: 'Sentence structure with the modal verb "can": S + can + V(infinitive).'
            },
            {
                type: 'fill-in-the-blank',
                question: '32. W__t a nice present!',
                correctAnswer: 'ha',
                correctAnswer_vi: 'ha',
                hint_vi: 'Câu cảm thán. (2 ký tự)',
                rationale_vi: 'Cấu trúc câu cảm thán: What + a/an + adj + N!',
                rationale_en: 'Exclamatory sentence structure: What + a/an + adj + N!'
            },
            {
                type: 'mc',
                question: '33. Sit ..., please!',
                options: [
                    { text: 'A. down', isCorrect: true },
                    { text: 'B. up', isCorrect: false },
                    { text: 'C. in', isCorrect: false },
                    { text: 'D. to', isCorrect: false }
                ],
                correctAnswer: 'A. down',
                correctAnswer_vi: 'xuống',
                hint_vi: 'Cụm từ có nghĩa là "ngồi xuống".',
                rationale_vi: 'Cụm động từ "Sit down" có nghĩa là "ngồi xuống".',
                rationale_en: 'The phrasal verb "Sit down" means to take a seat.'
            },
            {
                type: 'mc',
                question: '34. I’m from Vietnam. … you?',
                options: [
                    { text: 'A. What', isCorrect: false },
                    { text: 'B. How', isCorrect: false },
                    { text: 'C. How about', isCorrect: true },
                    { text: 'D. How many', isCorrect: false }
                ],
                correctAnswer: 'C. How about',
                correctAnswer_vi: 'Còn bạn thì sao',
                hint_vi: 'Cách hỏi lại một câu hỏi tương tự.',
                rationale_vi: '"How about you?" là cách hỏi ngắn gọn để hỏi lại người khác cùng một câu hỏi đã được đặt ra trước đó.',
                rationale_en: '"How about you?" is a short way to ask someone the same question that was just asked.'
            },
            {
                type: 'fill-in-the-blank',
                question: '35. What class is she __? She’s in class 4D.',
                correctAnswer: 'in',
                correctAnswer_vi: 'in',
                hint_vi: 'Giới từ đi với "class". (2 ký tự)',
                rationale_vi: 'Chúng ta dùng "in a class" để nói ai đó học lớp nào.',
                rationale_en: 'We use "in a class" to say which class someone is in.'
            },
            {
                type: 'rearrange',
                question: '36. is/ today./ Tuesday/ It/',
                words: ['It', 'is', 'Tuesday', 'today.'],
                correctAnswer: 'It is Tuesday today.',
                correctAnswer_vi: 'Hôm nay là thứ Ba.',
                hint_vi: 'Câu nói về ngày trong tuần.',
                rationale_vi: 'Cấu trúc: It is + [Thứ trong tuần] + today.',
                rationale_en: 'Structure: It is + [Day of the week] + today.'
            },
            {
                type: 'mc',
                question: '37. Odd one out:',
                options: [
                    { text: 'A. cake', isCorrect: false },
                    { text: 'B. kite', isCorrect: false },
                    { text: 'C. doll', isCorrect: false },
                    { text: 'D. school', isCorrect: true }
                ],
                correctAnswer: 'D. school',
                correctAnswer_vi: 'trường học',
                hint_vi: 'Tìm từ không phải là đồ vật/đồ chơi.',
                rationale_vi: '"cake", "kite", "doll" là các đồ vật/đồ chơi. "school" là một địa điểm.',
                rationale_en: '"cake", "kite", "doll" are objects/toys. "school" is a place.'
            },
            {
                type: 'fill-in-the-blank',
                question: '38. My favourite sub___t is Music.',
                correctAnswer: 'jec',
                correctAnswer_vi: 'jec',
                hint_vi: 'Từ có nghĩa là "môn học". (3 ký tự)',
                rationale_vi: 'Từ đúng là "subject" (môn học).',
                rationale_en: 'The correct word is "subject".'
            },
            {
                type: 'multimedia',
                question: '39. I can ____ English very well.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206440071561593_Audio.mp3',
                correctAnswer: 'speak',
                correctAnswer_vi: 'nói',
                hint_vi: 'Nghe và điền động từ. (5 ký tự)',
                rationale_vi: 'Bài nghe nói "I can speak English very well" (Tôi có thể nói tiếng Anh rất tốt).',
                rationale_en: 'The audio says "I can speak English very well".'
            },
            {
                type: 'mc',
                question: '40. Nam has ten pencils. Mai has four pencils. How many pencils do they have?',
                options: [
                    { text: 'A. sixteen', isCorrect: false },
                    { text: 'B. fourteen', isCorrect: true },
                    { text: 'C. fifteen', isCorrect: false },
                    { text: 'D. seventeen', isCorrect: false }
                ],
                correctAnswer: 'B. fourteen',
                correctAnswer_vi: 'mười bốn',
                hint_vi: 'Làm phép tính cộng: 10 + 4.',
                rationale_vi: 'Tổng số bút chì là 10 + 4 = 14 (fourteen).',
                rationale_en: 'The total number of pencils is 10 + 4 = 14 (fourteen).'
            },
            {
                type: 'multimedia',
                question: '41. He would like some ________.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2016/12/1/636161992202662771_Audio.mp3',
                correctAnswer: 'sandwiches',
                correctAnswer_vi: 'bánh sanhwich',
                hint_vi: 'Nghe và điền tên một loại thực phẩm. (10 ký tự)',
                rationale_vi: 'Bài nghe nói "He would like some sandwiches" (Anh ấy muốn một vài bánh sandwich).',
                rationale_en: 'The audio says "He would like some sandwiches".'
            },
            {
                type: 'mc',
                question: '42. She plays badminton at _______.',
                options: [
                    { text: 'A. Tuesdays', isCorrect: false },
                    { text: 'B. morning', isCorrect: false },
                    { text: 'C. school', isCorrect: false },
                    { text: 'D. break time', isCorrect: true }
                ],
                correctAnswer: 'D. break time',
                correctAnswer_vi: 'giờ giải lao',
                hint_vi: 'Khi nào người ta thường chơi thể thao ở trường?',
                rationale_vi: '"break time" (giờ giải lao) là thời điểm hợp lý để chơi cầu lông ở trường.',
                rationale_en: '"break time" is a logical time to play badminton at school.'
            },
            {
                type: 'fill-in-the-blank',
                question: '43. Mary likes reading. On her bookshelf, ____ are a lot of books.',
                correctAnswer: 'there',
                correctAnswer_vi: 'there',
                hint_vi: 'Cấu trúc "There are". (5 ký tự)',
                rationale_vi: 'Cấu trúc "There are" dùng để chỉ sự tồn tại của nhiều vật (a lot of books).',
                rationale_en: 'The structure "There are" is used to indicate the existence of multiple items (a lot of books).'
            },
            {
                type: 'rearrange',
                question: '44. Japanese./ from/ We are/ Japan. We/ are/',
                words: ['We are from', 'Japan. We', 'are', 'Japanese.'],
                correctAnswer: 'We are from Japan. We are Japanese.',
                correctAnswer_vi: 'Chúng tôi đến từ Nhật Bản. Chúng tôi là người Nhật.',
                hint_vi: 'Giới thiệu quốc gia và quốc tịch.',
                rationale_vi: 'Japan là tên quốc gia, Japanese là quốc tịch.',
                rationale_en: 'Japan is the country, Japanese is the nationality.'
            },
            {
                type: 'multimedia',
                question: '45. I ____ like a cake.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206419683550344_Audio.mp3',
                correctAnswer: 'would',
                correctAnswer_vi: 'would',
                hint_vi: 'Nghe và điền từ còn thiếu. (5 ký tự)',
                rationale_vi: 'Bài nghe nói "I would like a cake" (Tôi muốn một cái bánh).',
                rationale_en: 'The audio says "I would like a cake".'
            },
            {
                type: 'fill-in-the-blank',
                question: '46. What subject do you like the m_st, Tommy? - I like English.',
                correctAnswer: 'o',
                correctAnswer_vi: 'o',
                hint_vi: 'Từ có nghĩa là "nhất". (1 ký tự)',
                rationale_vi: 'Cụm từ "the most" có nghĩa là "nhất".',
                rationale_en: 'The phrase "the most" means "to the greatest extent".'
            },
            {
                type: 'mc',
                question: '47. ... birthday to you!',
                options: [
                    { text: 'A. Nice', isCorrect: false },
                    { text: 'B. Fine', isCorrect: false },
                    { text: 'C. Happy', isCorrect: true },
                    { text: 'D. Happily', isCorrect: false }
                ],
                correctAnswer: 'C. Happy',
                correctAnswer_vi: 'Chúc mừng',
                hint_vi: 'Câu chúc mừng sinh nhật.',
                rationale_vi: 'Câu chúc mừng sinh nhật phổ biến là "Happy birthday to you!".',
                rationale_en: 'The common birthday greeting is "Happy birthday to you!".'
            },
            {
                type: 'rearrange',
                question: '48. favourite day/ My/ is/ Thursday./',
                words: ['My', 'favourite day', 'is', 'Thursday.'],
                correctAnswer: 'My favourite day is Thursday.',
                correctAnswer_vi: 'Ngày yêu thích của tôi là thứ Năm.',
                hint_vi: 'Câu nói về sở thích.',
                rationale_vi: 'Cấu trúc: My favourite... is...',
                rationale_en: 'Structure: My favourite... is...'
            },
            {
                type: 'fill-in-the-blank',
                question: '49. The tenth month of a year is ____ber.',
                correctAnswer: 'Octo',
                correctAnswer_vi: 'Octo',
                hint_vi: 'Tháng 10. (4 ký tự)',
                rationale_vi: 'Tháng thứ mười trong năm là tháng Mười (October).',
                rationale_en: 'The tenth month of the year is October.'
            },
            {
                type: 'multimedia',
                question: '50. There are ... cows on the field.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208408619770764_566X320.jpg',
                options: [
                    { text: 'A. three', isCorrect: false },
                    { text: 'B. one', isCorrect: false },
                    { text: 'C. two', isCorrect: true },
                    { text: 'D. four', isCorrect: false }
                ],
                correctAnswer: 'C. two',
                correctAnswer_vi: 'hai',
                hint_vi: 'Đếm số con bò trong hình.',
                rationale_vi: 'Có hai con bò trong hình.',
                rationale_en: 'There are two cows in the picture.'
            },
            {
                type: 'fill-in-the-blank',
                question: '51. I can t__k with my mouth.',
                correctAnswer: 'al',
                correctAnswer_vi: 'al',
                hint_vi: 'Từ có nghĩa là "nói chuyện". (2 ký tự)',
                rationale_vi: 'Từ đúng là "talk" (nói chuyện).',
                rationale_en: 'The correct word is "talk".'
            },
            {
                type: 'rearrange',
                question: '52. in the living room/ sat/ together./ and watched TV/ My family/',
                words: ['My family', 'sat', 'in the living room', 'and watched TV', 'together.'],
                correctAnswer: 'My family sat in the living room and watched TV together.',
                correctAnswer_vi: 'Gia đình tôi đã ngồi trong phòng khách và cùng nhau xem TV.',
                hint_vi: 'Kể về một hoạt động gia đình.',
                rationale_vi: 'Câu kể lại một sự việc đã xảy ra trong quá khứ.',
                rationale_en: 'The sentence recounts a past family activity.'
            },
            {
                type: 'fill-in-the-blank',
                question: '53. Let’s play badminton. – That’s a good id__.',
                correctAnswer: 'ea',
                correctAnswer_vi: 'ea',
                hint_vi: 'Từ có nghĩa là "ý kiến". (2 ký tự)',
                rationale_vi: 'Từ đúng là "idea" (ý kiến, ý tưởng).',
                rationale_en: 'The correct word is "idea".'
            },
            {
                type: 'fill-in-the-blank',
                question: '54. Peter ha_ many rulers.',
                correctAnswer: 's',
                correctAnswer_vi: 's',
                hint_vi: 'Động từ "có". (1 ký tự)',
                rationale_vi: 'Chủ ngữ "Peter" (ngôi thứ ba số ít) đi với "has".',
                rationale_en: 'The subject "Peter" (third-person singular) goes with "has".'
            },
            {
                type: 'rearrange',
                question: '55. is/ Today/ November/ 21st./',
                words: ['Today is', 'November', '21st.'],
                correctAnswer: 'Today is November 21st.',
                correctAnswer_vi: 'Hôm nay là ngày 21 tháng 11.',
                hint_vi: 'Câu nói về ngày tháng.',
                rationale_vi: 'Cấu trúc nói ngày tháng: Today is + [Tháng] + [Ngày].',
                rationale_en: 'Structure for stating the date: Today is + [Month] + [Date].'
            },
            {
                type: 'multimedia',
                question: '56. The birthday is on the ___ of March.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/Thi_cac_cap/2020-2021/Lop4/Captruong/anh/D1_13.jpg',
                options: [
                    { text: 'A. twenty-sixth', isCorrect: true },
                    { text: 'B. twenty-eighth', isCorrect: false },
                    { text: 'C. twenty-six', isCorrect: false },
                    { text: 'D. twentieth-six', isCorrect: false }
                ],
                correctAnswer: 'A. twenty-sixth',
                correctAnswer_vi: 'ngày hai mươi sáu',
                hint_vi: 'Nhìn vào số trên bánh sinh nhật.',
                rationale_vi: 'Số trên bánh là "26th", được đọc là "twenty-sixth".',
                rationale_en: 'The number on the cake is "26th", which is read as "twenty-sixth".'
            },
            {
                type: 'fill-in-the-blank',
                question: '57. My school __ in Hoang Hoa Tham Street.',
                correctAnswer: 'is',
                correctAnswer_vi: 'is',
                hint_vi: 'Động từ "to be". (2 ký tự)',
                rationale_vi: 'Chủ ngữ "My school" là số ít, nên đi với động từ "is".',
                rationale_en: 'The subject "My school" is singular, so it goes with the verb "is".'
            },
            {
                type: 'rearrange',
                question: '58. my/ sister\'s/ birthday./ I don\'t/ remember/',
                words: ['I don\'t', 'remember', 'my sister\'s', 'birthday.'],
                correctAnswer: 'I don\'t remember my sister\'s birthday.',
                correctAnswer_vi: 'Tôi không nhớ ngày sinh nhật của chị gái tôi.',
                hint_vi: 'Câu phủ định.',
                rationale_vi: 'Cấu trúc: S + don\'t + V + O.',
                rationale_en: 'Structure: S + don\'t + V + O.'
            },
            {
                type: 'fill-in-the-blank',
                question: '59. The name __ my school is Phuong Mai Primary School.',
                correctAnswer: 'of',
                correctAnswer_vi: 'of',
                hint_vi: 'Giới từ chỉ sự sở hữu. (2 ký tự)',
                rationale_vi: 'Giới từ "of" được dùng để chỉ sự sở hữu, "The name of my school" có nghĩa là "tên của trường tôi".',
                rationale_en: 'The preposition "of" is used to show possession, "The name of my school" means "my school\'s name".'
            },
            {
                type: 'mc',
                question: '60. ST__MP',
                options: [
                    { text: 'A. E', isCorrect: false },
                    { text: 'B. EA', isCorrect: false },
                    { text: 'C. A', isCorrect: true },
                    { text: 'D. AE', isCorrect: false }
                ],
                correctAnswer: 'C. A',
                correctAnswer_vi: 'A',
                hint_vi: 'Từ có nghĩa là "con tem".',
                rationale_vi: 'Từ đúng là "STAMP" (con tem).',
                rationale_en: 'The correct word is "STAMP".'
            },
            {
                type: 'rearrange',
                question: '61. chant/ the/ Read/ aloud./',
                words: ['Read', 'the', 'chant', 'aloud.'],
                correctAnswer: 'Read the chant aloud.',
                correctAnswer_vi: 'Đọc to bài đồng dao.',
                hint_vi: 'Một câu yêu cầu.',
                rationale_vi: 'Đây là một câu mệnh lệnh, yêu cầu đọc to.',
                rationale_en: 'This is a command, an instruction to read aloud.'
            },
            {
                type: 'rearrange',
                question: '62. Linh is/ to her/ pen friend./ a letter/ writing/',
                words: ['Linh is', 'writing', 'a letter', 'to her', 'pen friend.'],
                correctAnswer: 'Linh is writing a letter to her pen friend.',
                correctAnswer_vi: 'Linh đang viết một lá thư cho người bạn qua thư của cô ấy.',
                hint_vi: 'Thì hiện tại tiếp diễn.',
                rationale_vi: 'Cấu trúc thì hiện tại tiếp diễn: S + is/are + V-ing + O.',
                rationale_en: 'Present continuous tense structure: S + is/are + V-ing + O.'
            },
            {
                type: 'mc',
                question: '63. How many hours are there in a day?',
                options: [
                    { text: 'A. There are 42 hours.', isCorrect: false },
                    { text: 'B. There are 12 hours.', isCorrect: false },
                    { text: 'C. There are 24 hours.', isCorrect: true },
                    { text: 'D. There are 28 hours.', isCorrect: false }
                ],
                correctAnswer: 'C. There are 24 hours.',
                correctAnswer_vi: 'Có 24 giờ.',
                hint_vi: 'Một ngày có bao nhiêu giờ?',
                rationale_vi: 'Một ngày có 24 giờ.',
                rationale_en: 'There are 24 hours in a day.'
            },
            {
                type: 'fill-in-the-blank',
                question: '64. He is my fri__d.',
                correctAnswer: 'en',
                correctAnswer_vi: 'en',
                hint_vi: 'Từ có nghĩa là "bạn". (2 ký tự)',
                rationale_vi: 'Từ đúng là "friend" (bạn bè).',
                rationale_en: 'The correct word is "friend".'
            },
            {
                type: 'multimedia',
                question: '65. That notebook is ... .',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208405696666672_566X320.jpg',
                options: [
                    { text: 'A. pink', isCorrect: false },
                    { text: 'B. red', isCorrect: false },
                    { text: 'C. yellow', isCorrect: false },
                    { text: 'D. blue', isCorrect: true }
                ],
                correctAnswer: 'D. blue',
                correctAnswer_vi: 'màu xanh dương',
                hint_vi: 'Nhìn màu của quyển vở.',
                rationale_vi: 'Quyển vở trong hình có màu xanh dương (blue).',
                rationale_en: 'The notebook in the picture is blue.'
            },
            {
                type: 'multimedia',
                question: '66. The flower is p__k.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2019/11/27/637104525681386344_566X320.jpg',
                correctAnswer: 'in',
                correctAnswer_vi: 'in',
                hint_vi: 'Từ chỉ màu hồng. (2 ký tự)',
                rationale_vi: 'Từ đúng là "pink" (màu hồng).',
                rationale_en: 'The correct word is "pink".'
            },
            {
                type: 'rearrange',
                question: '67. last weekend?/ What/ did you/ do/',
                words: ['What', 'did you', 'do', 'last weekend?'],
                correctAnswer: 'What did you do last weekend?',
                correctAnswer_vi: 'Bạn đã làm gì cuối tuần trước?',
                hint_vi: 'Câu hỏi ở thì quá khứ đơn.',
                rationale_vi: 'Cấu trúc câu hỏi với "What" ở thì quá khứ đơn: What + did + S + V(nguyên mẫu)?',
                rationale_en: 'Question structure with "What" in the simple past: What + did + S + V(infinitive)?'
            },
            {
                type: 'multimedia',
                question: '68. Do you like _______?',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206402357916087_Audio.mp3',
                correctAnswer: 'singing',
                correctAnswer_vi: 'ca hát',
                hint_vi: 'Nghe và điền vào chỗ trống. (7 ký tự)',
                rationale_vi: 'Bài nghe hỏi "Do you like singing?" (Bạn có thích ca hát không?).',
                rationale_en: 'The audio asks "Do you like singing?".'
            },
            {
                type: 'rearrange',
                question: '69. When/ you/ have/ do/ English?/',
                words: ['When', 'do you', 'have', 'English?'],
                correctAnswer: 'When do you have English?',
                correctAnswer_vi: 'Khi nào bạn có tiết tiếng Anh?',
                hint_vi: 'Câu hỏi về lịch học.',
                rationale_vi: 'Cấu trúc hỏi với "When" ở thì hiện tại đơn: When + do/does + S + V?',
                rationale_en: 'Question structure with "When" in the simple present: When + do/does + S + V?'
            },
            {
                type: 'rearrange',
                question: '70. the/ play/ I/ can/ violin./',
                words: ['I', 'can play', 'the', 'violin.'],
                correctAnswer: 'I can play the violin.',
                correctAnswer_vi: 'Tôi có thể chơi đàn violin.',
                hint_vi: 'Câu nói về khả năng.',
                rationale_vi: 'Cấu trúc: S + can + play + the + [nhạc cụ].',
                rationale_en: 'Structure: S + can + play + the + [musical instrument].'
            },
            {
                type: 'mc',
                question: '71. Odd one out:',
                options: [
                    { text: 'A. fish', isCorrect: false },
                    { text: 'B. cat', isCorrect: false },
                    { text: 'C. dog', isCorrect: false },
                    { text: 'D. book', isCorrect: true }
                ],
                correctAnswer: 'D. book',
                correctAnswer_vi: 'quyển sách',
                hint_vi: 'Tìm từ không phải là con vật.',
                rationale_vi: '"fish", "cat", "dog" là các con vật. "book" là đồ vật.',
                rationale_en: '"fish", "cat", "dog" are animals. "book" is an object.'
            },
            {
                type: 'rearrange',
                question: '72. the sky./ There are/ kites/ many/ in/',
                words: ['There are', 'many', 'kites', 'in', 'the sky.'],
                correctAnswer: 'There are many kites in the sky.',
                correctAnswer_vi: 'Có nhiều con diều trên bầu trời.',
                hint_vi: 'Bắt đầu với "There are".',
                rationale_vi: 'Cấu trúc "There are" dùng với danh từ số nhiều (kites).',
                rationale_en: 'The structure "There are" is used with plural nouns (kites).'
            },
            {
                type: 'mc',
                question: '73. She always … her teeth before going to school.',
                options: [
                    { text: 'A. clears', isCorrect: false },
                    { text: 'B. brushes', isCorrect: true },
                    { text: 'C. erases', isCorrect: false },
                    { text: 'D. opens', isCorrect: false }
                ],
                correctAnswer: 'B. brushes',
                correctAnswer_vi: 'đánh',
                hint_vi: 'Hành động làm sạch răng.',
                rationale_vi: '"brushes her teeth" có nghĩa là "đánh răng".',
                rationale_en: '"brushes her teeth" means to clean one\'s teeth with a brush.'
            },
            {
                type: 'mc',
                question: '74. Listen ... the teacher, please.',
                options: [
                    { text: 'A. at', isCorrect: false },
                    { text: 'B. on', isCorrect: false },
                    { text: 'C. to', isCorrect: true },
                    { text: 'D. in', isCorrect: false }
                ],
                correctAnswer: 'C. to',
                correctAnswer_vi: 'to',
                hint_vi: 'Cụm động từ "listen to".',
                rationale_vi: 'Cụm động từ "listen to" có nghĩa là "lắng nghe".',
                rationale_en: 'The phrasal verb "listen to" means to give attention to a sound.'
            },
            {
                type: 'multimedia',
                question: '75. The biggest bats are ____ bats.',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/11/29/636790849577880126_Audio.mp3',
                correctAnswer: 'fruit',
                correctAnswer_vi: 'ăn quả',
                hint_vi: 'Nghe và điền tên loại dơi. (5 ký tự)',
                rationale_vi: 'Bài nghe nói "The biggest bats are fruit bats" (Loài dơi lớn nhất là dơi ăn quả).',
                rationale_en: 'The audio says "The biggest bats are fruit bats".'
            },
            {
                type: 'fill-in-the-blank',
                question: '76. Would you like an ice-cr__m?',
                correctAnswer: 'ea',
                correctAnswer_vi: 'ea',
                hint_vi: 'Từ có nghĩa là "kem". (2 ký tự)',
                rationale_vi: 'Từ đúng là "ice-cream" (kem).',
                rationale_en: 'The correct word is "ice-cream".'
            },
            {
                type: 'mc',
                question: '77. Odd one out:',
                options: [
                    { text: 'A. one', isCorrect: false },
                    { text: 'B. three', isCorrect: false },
                    { text: 'C. four', isCorrect: false },
                    { text: 'D. fifth', isCorrect: true }
                ],
                correctAnswer: 'D. fifth',
                correctAnswer_vi: 'thứ năm',
                hint_vi: 'Tìm từ không phải là số đếm.',
                rationale_vi: '"one", "three", "four" là số đếm. "fifth" là số thứ tự.',
                rationale_en: '"one", "three", "four" are cardinal numbers. "fifth" is an ordinal number.'
            },
            {
                type: 'multimedia',
                question: '78. Listen and tick:',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/21/635206435918083072_Audio.mp3',
                options: [
                    { text: 'A. Where is your school?', isCorrect: false },
                    { text: 'B. When is her birthday?', isCorrect: false },
                    { text: 'C. Where is her school?', isCorrect: false },
                    { text: 'D. When is your birthday?', isCorrect: true }
                ],
                correctAnswer: 'D. When is your birthday?',
                correctAnswer_vi: 'Khi nào là sinh nhật của bạn?',
                hint_vi: 'Nghe kỹ câu hỏi.',
                rationale_vi: 'Bài nghe hỏi câu "When is your birthday?".',
                rationale_en: 'The audio asks the question "When is your birthday?".'
            },
            {
                type: 'fill-in-the-blank',
                question: '79. My school is in Bat Trang Vill___. It’s very big.',
                correctAnswer: 'age',
                correctAnswer_vi: 'age',
                hint_vi: 'Từ có nghĩa là "làng". (3 ký tự)',
                rationale_vi: 'Từ đúng là "village" (ngôi làng).',
                rationale_en: 'The correct word is "village".'
            },
            {
                type: 'fill-in-the-blank',
                question: '80. That is my b_droom.',
                correctAnswer: 'e',
                correctAnswer_vi: 'e',
                hint_vi: 'Từ có nghĩa là "phòng ngủ". (1 ký tự)',
                rationale_vi: 'Từ đúng là "bedroom" (phòng ngủ).',
                rationale_en: 'The correct word is "bedroom".'
            },
            {
                type: 'fill-in-the-blank',
                question: '81. Would you l___ an ice cream? - No, thanks.',
                correctAnswer: 'ike',
                correctAnswer_vi: 'ike',
                hint_vi: 'Cụm từ "would like". (3 ký tự)',
                rationale_vi: 'Cụm từ "Would you like...?" dùng để mời ai đó một cách lịch sự.',
                rationale_en: 'The phrase "Would you like...?" is a polite way to offer something.'
            },
            {
                type: 'mc',
                question: '82. Her house is .... big.',
                options: [
                    { text: 'A. much', isCorrect: false },
                    { text: 'B. very', isCorrect: true },
                    { text: 'C. many', isCorrect: false },
                    { text: 'D. old', isCorrect: false }
                ],
                correctAnswer: 'B. very',
                correctAnswer_vi: 'rất',
                hint_vi: 'Từ dùng để nhấn mạnh tính từ.',
                rationale_vi: '"very" được dùng để bổ nghĩa cho tính từ "big".',
                rationale_en: '"very" is used to modify the adjective "big".'
            },
            {
                type: 'fill-in-the-blank',
                question: '83. We a__ having a break.',
                correctAnswer: 're',
                correctAnswer_vi: 're',
                hint_vi: 'Thì hiện tại tiếp diễn. (2 ký tự)',
                rationale_vi: 'Chủ ngữ "We" đi với "are" trong thì hiện tại tiếp diễn (are having).',
                rationale_en: 'The subject "We" goes with "are" in the present continuous tense (are having).'
            },
            {
                type: 'fill-in-the-blank',
                question: '84. PE__CH',
                correctAnswer: 'A',
                correctAnswer_vi: 'A',
                hint_vi: 'Tên một loại quả. (1 ký tự)',
                rationale_vi: 'Từ đúng là "PEACH" (quả đào).',
                rationale_en: 'The correct word is "PEACH".'
            },
            {
                type: 'mc',
                question: '85. ... the weather in Hanoi today?',
                options: [
                    { text: 'A. What’s', isCorrect: false },
                    { text: 'B. Where’s', isCorrect: false },
                    { text: 'C. How’s', isCorrect: true },
                    { text: 'D. And', isCorrect: false }
                ],
                correctAnswer: 'C. How’s',
                correctAnswer_vi: 'Thời tiết thế nào',
                hint_vi: 'Câu hỏi về thời tiết.',
                rationale_vi: 'Câu hỏi "How’s the weather?" dùng để hỏi về tình hình thời tiết. "What\'s the weather like?" cũng đúng nhưng không có trong phương án.',
                rationale_en: 'The question "How’s the weather?" is used to ask about weather conditions. "What\'s the weather like?" is also correct but not an option.'
            },
            {
                type: 'mc',
                question: '86. Can you give me a photo ... you?',
                options: [
                    { text: 'A. at', isCorrect: false },
                    { text: 'B. of', isCorrect: true },
                    { text: 'C. in', isCorrect: false },
                    { text: 'D. from', isCorrect: false }
                ],
                correctAnswer: 'B. of',
                correctAnswer_vi: 'của',
                hint_vi: 'Giới từ chỉ sự sở hữu.',
                rationale_vi: '"a photo of you" có nghĩa là "một bức ảnh của bạn".',
                rationale_en: '"a photo of you" means a picture in which you are the subject.'
            },
            {
                type: 'multimedia',
                question: '87. My father w____ to work every day.',
                mediaType: 'image',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2013/11/23/635208424295895232_566X320.jpg',
                correctAnswer: 'alks',
                correctAnswer_vi: 'alks',
                hint_vi: 'Từ có nghĩa là "đi bộ". (4 ký tự)',
                rationale_vi: 'Từ đúng là "walks" (đi bộ). Động từ thêm "s" vì chủ ngữ là "My father".',
                rationale_en: 'The correct word is "walks". The verb has an "s" because the subject is "My father".'
            },
            {
                type: 'rearrange',
                question: '88. from/ birthday/ I have many/ my friends./ presents/',
                words: ['I have many', 'birthday', 'presents', 'from', 'my friends.'],
                correctAnswer: 'I have many birthday presents from my friends.',
                correctAnswer_vi: 'Tôi có nhiều quà sinh nhật từ bạn bè của tôi.',
                hint_vi: 'Câu kể.',
                rationale_vi: 'Trật tự câu đúng là: S + V + O. "birthday presents" là một cụm danh từ.',
                rationale_en: 'The correct sentence order is: S + V + O. "birthday presents" is a noun phrase.'
            },
            {
                type: 'rearrange',
                question: '89. red/ have/ a/ I/ kite./',
                words: ['I', 'have', 'a', 'red', 'kite.'],
                correctAnswer: 'I have a red kite.',
                correctAnswer_vi: 'Tôi có một con diều màu đỏ.',
                hint_vi: 'Câu nói về sự sở hữu.',
                rationale_vi: 'Cấu trúc: S + have/has + a/an + adj + N.',
                rationale_en: 'Structure: S + have/has + a/an + adj + N.'
            },
            {
                type: 'fill-in-the-blank',
                question: '90. H__’s the weather in Hanoi?',
                correctAnswer: 'ow',
                correctAnswer_vi: 'ow',
                hint_vi: 'Câu hỏi về thời tiết. (2 ký tự)',
                rationale_vi: 'Từ để hỏi là "How". "How\'s" là viết tắt của "How is".',
                rationale_en: 'The question word is "How". "How\'s" is a contraction of "How is".'
            },
            {
                type: 'mc',
                question: '91. Choose the odd one out:',
                options: [
                    { text: 'A. skip', isCorrect: false },
                    { text: 'B. ski', isCorrect: false },
                    { text: 'C. climb', isCorrect: false },
                    { text: 'D. puzzle', isCorrect: true }
                ],
                correctAnswer: 'D. puzzle',
                correctAnswer_vi: 'trò chơi xếp hình',
                hint_vi: 'Tìm từ không phải là một động từ/hành động.',
                rationale_vi: '"skip", "ski", "climb" là các động từ chỉ hành động. "puzzle" là một danh từ chỉ đồ vật/trò chơi.',
                rationale_en: '"skip", "ski", "climb" are verbs of action. "puzzle" is a noun for an object/game.'
            },
            {
                type: 'rearrange',
                question: '92. hat?/ is/ How/ that/ much/',
                words: ['How much', 'is', 'that', 'hat?'],
                correctAnswer: 'How much is that hat?',
                correctAnswer_vi: 'Cái mũ đó giá bao nhiêu?',
                hint_vi: 'Câu hỏi về giá cả.',
                rationale_vi: 'Cấu trúc hỏi giá: How much + is/are + S?',
                rationale_en: 'Structure for asking price: How much + is/are + S?'
            },
            {
                type: 'mc',
                question: '93. Choose the word that has the underlined part pronounced differently from the others',
                options: [
                    { text: 'A. Br<u>ea</u>d', isCorrect: true },
                    { text: 'B. Cl<u>ea</u>n', isCorrect: false },
                    { text: 'C. R<u>ea</u>d', isCorrect: false },
                    { text: 'D. M<u>ea</u>t', isCorrect: false }
                ],
                correctAnswer: 'A. Bread',
                correctAnswer_vi: 'Bánh mì',
                hint_vi: 'Chú ý phát âm của "ea".',
                rationale_vi: 'Trong "Bread", "ea" được phát âm là /e/. Trong các từ còn lại, "ea" được phát âm là /i:/.',
                rationale_en: 'In "Bread", "ea" is pronounced /e/. In the other words, "ea" is pronounced /i:/.'
            },
            {
                type: 'fill-in-the-blank',
                question: '94. I like to play wi__ a yo-yo.',
                correctAnswer: 'th',
                correctAnswer_vi: 'th',
                hint_vi: 'Giới từ có nghĩa là "với". (2 ký tự)',
                rationale_vi: 'Giới từ "with" có nghĩa là "cùng với".',
                rationale_en: 'The preposition "with" means "accompanied by".'
            },
            {
                type: 'mc',
                question: '95. Which month is right after March? - ... .',
                options: [
                    { text: 'A. April', isCorrect: true },
                    { text: 'B. May', isCorrect: false },
                    { text: 'C. February', isCorrect: false },
                    { text: 'D. June', isCorrect: false }
                ],
                correctAnswer: 'A. April',
                correctAnswer_vi: 'Tháng Tư',
                hint_vi: 'Tháng ngay sau tháng Ba là tháng nào?',
                rationale_vi: 'Tháng Tư (April) là tháng ngay sau tháng Ba (March).',
                rationale_en: 'April is the month right after March.'
            },
            {
                type: 'rearrange',
                question: '96. the/ Look/ at/ timetable, please!/',
                words: ['Look', 'at', 'the', 'timetable,', 'please!'],
                correctAnswer: 'Look at the timetable, please!',
                correctAnswer_vi: 'Làm ơn nhìn vào thời khóa biểu!',
                hint_vi: 'Một câu yêu cầu.',
                rationale_vi: 'Cụm từ "Look at" có nghĩa là "nhìn vào".',
                rationale_en: 'The phrase "Look at" means to direct your eyes towards something.'
            },
            {
                type: 'multimedia',
                question: '97. What lesson are they having?',
                mediaType: 'audio',
                mediaSource: 'https://res.ioe.vn/edu/EOlympic/ExamData/ImageExam/2018/1/3/636505760095803543_Audio.mp3',
                options: [
                    { text: 'A. Science', isCorrect: true },
                    { text: 'B. Maths', isCorrect: false },
                    { text: 'C. PE', isCorrect: false },
                    { text: 'D. Vietnamese', isCorrect: false }
                ],
                correctAnswer: 'B. Maths',
                correctAnswer_vi: 'Toán',
                hint_vi: 'Nghe và xác định môn học.',
                rationale_vi: 'Bài nghe có đề cập đến hình tròn, mặt trăng.',
                rationale_en: 'The audio mentions the moon, round shape.'
            },
            {
                type: 'mc',
                question: '98. These ... my rulers.',
                options: [
                    { text: 'A. and', isCorrect: false },
                    { text: 'B. is', isCorrect: false },
                    { text: 'C. are', isCorrect: true },
                    { text: 'D. a', isCorrect: false }
                ],
                correctAnswer: 'C. are',
                correctAnswer_vi: 'are',
                hint_vi: 'Động từ "to be" cho danh từ số nhiều.',
                rationale_vi: 'Chủ ngữ "These" là số nhiều, nên đi với động từ "are".',
                rationale_en: 'The subject "These" is plural, so it goes with the verb "are".'
            },
            {
                type: 'fill-in-the-blank',
                question: '99. We are __ home on Sundays.',
                correctAnswer: 'at',
                correctAnswer_vi: 'at',
                hint_vi: 'Giới từ đi với "home". (2 ký tự)',
                rationale_vi: 'Giới từ "at" thường được dùng với "home" (at home).',
                rationale_en: 'The preposition "at" is commonly used with "home" (at home).'
            },
            {
                type: 'mc',
                question: '100. Look ... the board, please.',
                options: [
                    { text: 'A. to', isCorrect: false },
                    { text: 'B. on', isCorrect: false },
                    { text: 'C. at', isCorrect: true },
                    { text: 'D. for', isCorrect: false }
                ],
                correctAnswer: 'C. at',
                correctAnswer_vi: 'vào',
                hint_vi: 'Cụm từ "nhìn vào".',
                rationale_vi: 'Cụm động từ "Look at" có nghĩa là "nhìn vào cái gì đó".',
                rationale_en: 'The phrasal verb "Look at" means to direct your eyes towards something.'
            }
        ];
        
        // --- Component: MediaDisplay (Helper for Image/Audio rendering) ---
        const MediaDisplay = ({ question, showMessage }) => {
            if (question.mediaType === 'image') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🖼️ Nhìn hình và trả lời</p>
                        <img 
                            src={question.mediaSource}
                            alt={`Hình ảnh IOE: ${question.imagePrompt || 'Chủ đề câu hỏi'}`} 
                            className="w-full max-w-xs mx-auto rounded-lg shadow-md border-2 border-gray-300"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={(e) => { 
                                e.target.onerror = null; 
                                e.target.src = `https://placehold.co/566x320/FF0000/FFFFFF?text=L%E1%BB%97I+T%E1%BA%A2I+%E1%BA%A2NH+(CORS)`; 
                                showMessage('Lỗi tải ảnh: File media có thể bị chặn bởi trình duyệt.', 'error');
                            }}
                        />
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                        {question.imagePrompt && <p className="text-sm text-blue-600 mt-2 font-medium">Gợi ý nội dung: {question.imagePrompt}</p>}
                    </div>
                );
            }

            if (question.mediaType === 'audio') {
                return (
                    <div className="w-full p-4 bg-gray-100 rounded-xl mb-4 text-center border-2 border-dashed border-gray-300">
                        <p className="text-blue-600 font-bold mb-2">🔊 Nghe và trả lời (Bấm Play)</p>
                        <audio 
                            controls
                            src={question.mediaSource}
                            className="w-full max-w-sm mx-auto my-2"
                            crossOrigin="anonymous"
                            referrerPolicy="no-referrer"
                            onError={() => {
                                showMessage('Lỗi tải Audio: File media có thể bị chặn.', 'error');
                            }}
                        >
                            <source src={question.mediaSource} type="audio/mp3" />
                            Trình duyệt của bạn không hỗ trợ phần tử audio.
                        </audio>
                        <p className="text-xs text-gray-500 mt-2 break-all">Link gốc: {question.mediaSource}</p>
                    </div>
                );
            }
            return null;
        }

        // --- Component: ProgressBar.tsx ---
        const ProgressBar = ({ percentage }) => {
            return (
                <div className="w-full h-2 bg-blue-100 rounded-full mt-4 overflow-hidden">
                    <div
                        className="h-full bg-blue-500 transition-all duration-500 ease-in-out"
                        style={{ width: `${percentage}%` }}
                    ></div>
                </div>
            );
        };
        
        // --- Component: MessageBox.tsx ---
        const MessageBox = ({ message, type }) => {
            const [visible, setVisible] = React.useState(false);

            React.useEffect(() => {
                if (message) {
                    setVisible(true);
                    const timer = setTimeout(() => {
                        setVisible(false);
                    }, 2700);
                    return () => clearTimeout(timer);
                } else {
                    setVisible(false);
                }
            }, [message, type]);

            const baseClasses = "fixed top-4 left-1/2 -translate-x-1/2 p-4 rounded-xl shadow-xl text-center font-bold text-lg z-50 transition-all duration-300 transform";
            
            const typeClasses = {
                success: 'bg-green-100 border border-green-500 text-green-800',
                error: 'bg-red-100 border-red-500 text-red-800',
                info: 'bg-yellow-100 border border-yellow-500 text-yellow-800',
            };

            const visibilityClasses = visible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none';

            return (
                <div className={`${baseClasses} ${typeClasses[type]} ${visibilityClasses}`}>
                    {message}
                </div>
            );
        };
        
        // --- Component: RationaleBox.tsx ---
        const RationaleBox = ({ question, isCorrect, submittedAnswer }) => {
            const boxClasses = `mt-6 p-4 rounded-xl border transition duration-300 fade-in border-l-4 ${
                isCorrect ? 'bg-green-100 border-green-600' : 'bg-red-100 border-red-600'
            }`;
            
            const submittedAnswerDisplay = () => {
                const isFillIn = question.type === 'fill-in-the-blank' || (question.type === 'multimedia' && !question.options);
                
                if(isCorrect && !isFillIn) return null;
                
                return (
                    <>
                        <strong className="text-gray-700">
                           Bạn đã chọn/Điền:
                        </strong>
                        <span className="text-red-700 font-medium break-words"> {submittedAnswer}</span>
                        <br/>
                    </>
                );
            }

            return (
                <div className={boxClasses}>
                    <p className="font-bold text-lg mb-2 text-blue-700">Giải thích:</p>
                    <div className="text-gray-700 space-y-1">
                        {!isCorrect && submittedAnswerDisplay()}
                        <p><strong>Đáp án đúng:</strong> <span className="text-green-800 font-semibold">{question.correctAnswer}</span></p>
                        
                        {question.correctAnswer_vi && (
                            <p><strong>Dịch nghĩa:</strong> <span className="text-green-600 font-medium">{question.correctAnswer_vi}</span></p>
                        )}
                        <p className="pt-2 border-t border-gray-300 mt-2">{question.rationale_vi || 'Không có giải thích chi tiết.'}</p>
                    </div>
                </div>
            );
        };

        // --- Component: FillInTheBlankQuestion.tsx ---
        const FillInTheBlankQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [inputValue, setInputValue] = React.useState('');
            const inputRef = React.useRef(null);

            React.useEffect(() => {
                setInputValue('');
                if (inputRef.current && !isAnswered) {
                    inputRef.current.focus();
                }
            }, [question, isAnswered]);

            const handleSubmitClick = () => {
                const trimmedInput = inputValue.trim();
                if (trimmedInput === '') {
                    showMessage('Vui lòng điền câu trả lời của bạn!', 'info');
                    return;
                }
                const isCorrect = trimmedInput.toLowerCase() === question.correctAnswer.toLowerCase();
                onSubmit(trimmedInput, isCorrect);
            };
            
            const questionTextParts = React.useMemo(() => {
                let text = question.question.replace(/^\d+\.\s*/, '');
                
                const markers = ['____', '________', '__________', '___________', '_________', '_______', '______', '_____', '___', '__', '_'];

                for (const marker of markers) {
                    if (text.includes(marker)) {
                        const parts = text.split(marker);
                        return [parts[0], parts.slice(1).join(marker)];
                    }
                }
                 // Handle partial words like `c__se`
                const partialMatch = text.match(/(.*)__+(.*)/) || text.match(/(.*)\_+(.*)/);
                if (partialMatch) {
                    return [partialMatch[1], partialMatch[2]];
                }

                return [text, '']; 
            }, [question.question]);
            
            let inputClasses = 'inline-block mx-2 p-2 border-2 rounded-lg text-xl text-center shadow-sm transition duration-200 align-baseline w-48 font-mono font-bold';
            if (isAnswered) {
                const isSubmissionCorrect = inputValue.trim().toLowerCase() === question.correctAnswer.toLowerCase();
                inputClasses += isSubmissionCorrect ? ' border-green-500 bg-green-50' : ' border-red-500 bg-red-50';
            } else {
                inputClasses += ' border-gray-300 focus:border-blue-500';
            }

            const inputWidthStyle = {
                width: `${Math.max(6, question.correctAnswer.length * 2)}rem`, 
                maxWidth: '100%',
            };


            return (
                <div className="space-y-4">
                     {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    <div className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed text-center flex justify-center items-center flex-wrap">
                        <span className="mr-2">{questionIndex + 1}.</span>
                        {questionTextParts[0] && <span>{questionTextParts[0]}</span>}
                        <input
                            ref={inputRef}
                            type="text"
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            disabled={isAnswered}
                            placeholder={isAnswered ? question.correctAnswer : ""}
                            className={inputClasses}
                            style={inputWidthStyle}
                            onKeyPress={(e) => e.key === 'Enter' && !isAnswered && handleSubmitClick()}
                            aria-label="Fill in the blank"
                        />
                        {questionTextParts[1] && <span>{questionTextParts[1]}</span>}
                    </div>
                    <button
                        onClick={handleSubmitClick}
                        disabled={isAnswered}
                        className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                    >
                        Kiểm Tra
                    </button>
                </div>
            );
        };
        
        // --- Component: MultipleChoiceQuestion.tsx ---
        const MultipleChoiceQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex }) => {
            const [selectedIndex, setSelectedIndex] = React.useState(null);

            React.useEffect(() => {
                setSelectedIndex(null);
            }, [question]);

            const handleSubmitClick = () => {
                if (selectedIndex === null) {
                    showMessage('Vui lòng chọn một đáp án!', 'info');
                    return;
                }
                const selectedOption = question.options[selectedIndex];
                onSubmit(selectedOption.text, selectedOption.isCorrect);
            };

            return (
                <>
                    {question.mediaType && <MediaDisplay question={question} showMessage={showMessage} />}
                    
                    <h3
                        className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className="space-y-3">
                            {question.options.map((option, index) => {
                                const isSelected = selectedIndex === index;
                                let labelClasses = "block p-4 border-2 rounded-xl shadow-md text-xl font-bold transition duration-200";

                                if (isAnswered) {
                                    labelClasses += " cursor-default";
                                    if (option.isCorrect) {
                                        labelClasses += " bg-green-100 border-green-500";
                                    } else if (isSelected) {
                                        labelClasses += " bg-red-100 border-red-500";
                                    } else {
                                        labelClasses += " border-gray-200 opacity-60";
                                    }
                                } else {
                                    labelClasses += " cursor-pointer hover:bg-blue-50 hover:border-blue-300";
                                    if(isSelected) {
                                        labelClasses += " bg-blue-100 border-blue-500";
                                    } else {
                                        labelClasses += " border-gray-200";
                                    }
                                }

                                return (
                                    <div key={index} className="relative">
                                        <input
                                            type="radio"
                                            id={`option-${questionIndex}-${index}`}
                                            name={`mc-option-${questionIndex}`}
                                            value={index}
                                            className="hidden"
                                            checked={isSelected}
                                            onChange={() => setSelectedIndex(index)}
                                            disabled={isAnswered}
                                        />
                                        <label htmlFor={`option-${questionIndex}-${index}`} className={labelClasses} dangerouslySetInnerHTML={{ __html: option.text }}></label>
                                    </div>
                                );
                            })}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: RearrangeQuestion.tsx ---
        const WordBlock = ({ word, onClick, isSource, isAnswered }) => {
            const baseClasses = 'word-block px-4 py-2 text-xl font-bold rounded-lg shadow-sm transition-all duration-150 break-words transform active:scale-95';
            const sourceClasses = isSource ? 'bg-blue-100 text-blue-800 hover:bg-blue-200' : 'bg-gray-100 text-gray-800 border-b-2 border-gray-300';
            const disabledClasses = 'opacity-60 cursor-default shadow-inner';
            const interactiveClasses = 'cursor-pointer';

            return (
                <span
                    onClick={!isAnswered ? onClick : undefined}
                    className={`${baseClasses} ${sourceClasses} ${isAnswered ? disabledClasses : interactiveClasses}`}
                >
                    {word.text}
                </span>
            );
        };

        const RearrangeQuestion = ({ question, isAnswered, onSubmit, showMessage, questionIndex, isCorrect }) => {
            const [sentenceWords, setSentenceWords] = React.useState([]);
            
            const initialSourceWords = React.useMemo(() => {
                return [...question.words]
                    .map((text) => ({ id: crypto.randomUUID(), text })) 
                    .sort(() => Math.random() - 0.5);
            }, [question]);

            const [sourceWords, setSourceWords] = React.useState(initialSourceWords);

            React.useEffect(() => {
                setSourceWords(initialSourceWords);
                setSentenceWords([]);
            }, [initialSourceWords]);

            const handleSelectWord = (word) => {
                setSourceWords(prev => prev.filter(w => w.id !== word.id));
                setSentenceWords(prev => [...prev, word]);
            };

            const handleReturnWord = (word) => {
                setSentenceWords(prev => prev.filter(w => w.id !== word.id));
                setSourceWords(prev => [...prev, word].sort((a, b) => initialSourceWords.findIndex(sw => sw.id === a.id) - initialSourceWords.findIndex(sw => sw.id === b.id)));
            };

            const handleSubmitClick = () => {
                if (sentenceWords.length === 0) {
                    showMessage('Vui lòng sắp xếp các từ!', 'info');
                    return;
                }
                
                const submitted = sentenceWords.map(w => w.text).join(' ').replace(/\s+([.,?!])/g, '$1').trim();
                const normalize = (str) => str.replace(/’/g, "'").replace(/[.,?!]/g, '').replace(/\s+/g, ' ').toLowerCase().trim();
                
                const isCorrectResult = normalize(submitted) === normalize(question.correctAnswer);
                onSubmit(submitted, isCorrectResult);
            };

            return (
                <>
                    <h3
                        className="text-2xl sm:text-3xl font-bold mb-6 leading-relaxed"
                        dangerouslySetInnerHTML={{ __html: `${questionIndex + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                    />
                    <div className="space-y-4">
                        <div className={`min-h-[70px] p-3 border-2 rounded-xl shadow-inner flex flex-wrap gap-2 items-center transition duration-300 ${isAnswered ? (isCorrect ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50') : 'border-blue-300 bg-blue-50 border-dashed'}`}>
                            {sentenceWords.length === 0 && !isAnswered ? (
                                <span className="text-gray-500 italic text-base">Chạm vào các từ bên dưới để xây dựng câu trả lời...</span>
                            ) : (
                                sentenceWords.map(word => (
                                    <WordBlock key={word.id} word={word} onClick={() => handleReturnWord(word)} isSource={false} isAnswered={isAnswered} />
                                ))
                            )}
                        </div>
                        
                        <div className="min-h-[120px] p-4 bg-gray-100 rounded-xl shadow-md flex flex-wrap gap-2 items-center border border-gray-200">
                            {sourceWords.map(word => (
                                <WordBlock key={word.id} word={word} onClick={() => handleSelectWord(word)} isSource={true} isAnswered={isAnswered} />
                            ))}
                        </div>
                        <button
                            onClick={handleSubmitClick}
                            disabled={isAnswered}
                            className="w-full py-3 px-4 bg-green-600 text-white font-extrabold text-xl rounded-lg shadow-md transition duration-300 hover:bg-green-700 mt-4 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98"
                        >
                            Kiểm Tra
                        </button>
                    </div>
                </>
            );
        };
        
        // --- Component: StartScreen.tsx ---
        const StartScreen = ({ onStart, totalQuestions, testName }) => {
            const [name, setName] = React.useState('');

            const handleStart = () => {
                if (name.trim()) {
                    onStart(name.trim());
                }
            };

            const isButtonDisabled = name.trim() === '';

            return (
                <div className="fade-in text-center p-4">
                    <header className="mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-blue-600 mb-2">{testName}</h1>
                        <p className="text-xl text-gray-500">Bộ đề luyện thi IOE dành cho khối 4</p>
                    </header>
                    <div className="max-w-md mx-auto bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                        <h2 className="text-2xl font-bold mb-4 text-gray-700">Chào mừng bạn!</h2>
                        <p className="text-gray-600 mb-6 text-lg">Mỗi câu trả lời đúng được cộng 10 điểm. Bài thi có {totalQuestions} câu.</p>
                        <div className="space-y-4">
                            <label htmlFor="player-name" className="block text-base font-medium text-gray-700 text-left">Nhập tên của bạn để bắt đầu:</label>
                            <input
                                type="text"
                                id="player-name"
                                placeholder="Tên của bạn"
                                className="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg shadow-sm transition duration-150"
                                maxLength={50}
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && !isButtonDisabled && handleStart()}
                            />
                            <button
                                onClick={handleStart}
                                disabled={isButtonDisabled}
                                className="w-full py-3 px-4 bg-yellow-400 text-yellow-900 font-extrabold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-500 disabled:bg-gray-300 disabled:cursor-not-allowed text-2xl active:scale-98"
                            >
                                Bắt Đầu
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // --- Component: EndScreen.tsx ---
        const EndScreen = ({ playerName, score, totalQuestions, onRestart, onReview, testName }) => {
            const maxScore = totalQuestions * 10;
            const percentage = maxScore > 0 ? (score / maxScore) * 100 : 0;
            
            let encouragement = "Cố gắng hơn ở lần sau nhé!";
            if (percentage >= 90) {
                encouragement = "Xuất sắc! Bạn thật là giỏi!";
            } else if (percentage >= 70) {
                encouragement = "Làm tốt lắm! Chỉ cần cố gắng thêm một chút nữa thôi.";
            } else if (percentage >= 50) {
                encouragement = "Khá tốt! Hãy tiếp tục ôn luyện nhé.";
            }

            return (
                <div className="text-center fade-in p-4">
                    <h2 className="text-4xl font-extrabold mb-2 text-green-600">🎉 Hoàn Thành! 🎉</h2>
                    <p className="text-2xl text-gray-700 mb-2">
                        Chúc mừng, <span className="font-extrabold text-blue-600">{playerName}</span>!
                    </p>
                    <p className="text-xl text-gray-600 mb-4">
                        Bạn đã hoàn thành bài thi <span className="font-bold text-blue-600">{testName}</span>.
                    </p>
                     <p className="text-lg text-gray-500 mb-6">{encouragement}</p>
                    <div className="bg-white p-8 rounded-xl shadow-lg inline-block border border-gray-100">
                        <p className="text-2xl font-bold mb-8 text-gray-700">Điểm số của bạn:</p>
                        <p className={`text-7xl font-black mb-10 text-blue-700`}>
                            {score} / {maxScore}
                        </p>
                    </div>
                    <div className="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                        {onReview && (
                             <button
                                onClick={onReview}
                                className="py-3 px-6 bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-yellow-600 text-lg active:scale-98"
                            >
                                Xem lại câu sai
                            </button>
                        )}
                        <button
                            onClick={onRestart}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Làm lại bài thi
                        </button>
                    </div>
                </div>
            );
        };

        // --- Component: ReviewScreen.tsx ---
        const ReviewScreen = ({ incorrectAnswers, onBack, testName }) => {
            return (
                <div className="fade-in">
                    <header className="text-center mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-yellow-600 mb-2">Ôn tập các câu sai</h1>
                        <p className="text-xl text-gray-500">Bài thi: {testName}</p>
                    </header>
                    <div className="space-y-8">
                        {incorrectAnswers.map(({ question, submittedAnswer }, index) => (
                            <div key={index} className="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                <h3 className="text-2xl sm:text-3xl font-bold mb-4 leading-relaxed"
                                    dangerouslySetInnerHTML={{ __html: `${index + 1}. ${question.question.replace(/^\d+\.\s*/, '')}` }}
                                />
                                {question.mediaType && <MediaDisplay question={question} showMessage={() => {}} />}
                                <RationaleBox question={question} isCorrect={false} submittedAnswer={submittedAnswer} />
                            </div>
                        ))}
                    </div>
                    <div className="mt-8 text-center">
                        <button
                            onClick={onBack}
                            className="py-3 px-6 bg-blue-500 text-white font-bold rounded-xl shadow-lg transition duration-300 hover:bg-blue-600 text-lg active:scale-98"
                        >
                            Quay lại màn hình điểm
                        </button>
                    </div>
                </div>
            );
        };
        
        // --- Component: QuizScreen.tsx ---
        const QuizScreen = ({ playerName, onEnd, totalQuestions, questionSet, testName }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [isAnswered, setIsAnswered] = React.useState(false);
            const [isCorrect, setIsCorrect] = React.useState(false);
            const [submittedAnswer, setSubmittedAnswer] = React.useState('');
            const [isHintVisible, setIsHintVisible] = React.useState(false);
            const [message, setMessage] = React.useState(null);
            const incorrectAnswersRef = React.useRef([]);
            
            const currentQuestion = questionSet[currentQuestionIndex];

            React.useEffect(() => {
                incorrectAnswersRef.current = [];
            }, [questionSet]);

             React.useEffect(() => {
                setIsAnswered(false);
                setIsCorrect(false);
                setSubmittedAnswer('');
                setIsHintVisible(false);
                setMessage(null);
            }, [currentQuestionIndex]);
            
            const showMessage = (text, type) => {
                setMessage({ text, type });
            };

            const handleSubmit = (answer, isAnswerCorrect) => {
                if (isAnswered) return;
                
                setIsAnswered(true);
                setSubmittedAnswer(answer);
                setIsCorrect(isAnswerCorrect);

                if (isAnswerCorrect) {
                    setScore(prev => prev + 10);
                    showMessage('CHÍNH XÁC! +10 điểm', 'success');
                } else {
                    showMessage('SAI RỒI! Hãy xem lại nhé.', 'error');
                    incorrectAnswersRef.current.push({ question: currentQuestion, submittedAnswer: answer });
                }
            };

            const handleNext = () => {
                if (currentQuestionIndex < totalQuestions - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    onEnd(score, incorrectAnswersRef.current);
                }
            };

            if (!currentQuestion) {
                return <div className="text-center p-8">Đang tải câu hỏi...</div>;
            }

            const progressPercentage = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            
            const renderQuestionComponent = () => {
                const commonProps = {
                    question: currentQuestion,
                    isAnswered,
                    onSubmit: handleSubmit,
                    showMessage,
                    questionIndex: currentQuestionIndex,
                    isCorrect: isCorrect, 
                };

                if (currentQuestion.type === 'rearrange') {
                    return <RearrangeQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'mc' || (currentQuestion.type === 'multimedia' && currentQuestion.options)) {
                    return <MultipleChoiceQuestion {...commonProps} />;
                }
                if (currentQuestion.type === 'fill-in-the-blank' || (currentQuestion.type === 'multimedia' && !currentQuestion.options)) {
                    return <FillInTheBlankQuestion {...commonProps} />;
                }
                
                return <div className="text-red-500">Lỗi: Loại câu hỏi không xác định.</div>;
            };

            return (
                <div className="fade-in">
                    {message && <MessageBox message={message.text} type={message.type} />}
                    <header className="text-center mb-8">
                        <h1 className="text-4xl sm:text-5xl font-extrabold text-blue-600 mb-2">{testName}</h1>
                        <ProgressBar percentage={progressPercentage} />
                    </header>

                    <div className="flex justify-between items-center mb-6 py-2 px-4 bg-blue-50 rounded-xl shadow-inner border border-blue-100">
                        <p className="text-lg font-medium text-blue-800">Bạn: <span className="font-bold">{playerName}</span></p>
                        <p className="text-lg font-medium text-blue-800">Điểm: <span className="text-2xl font-extrabold text-red-600">{score}</span></p>
                        <p className="text-lg font-medium text-blue-800">Câu: <span className="font-bold">{currentQuestionIndex + 1}/{totalQuestions}</span></p>
                    </div>

                    <div className="mb-8">
                        {renderQuestionComponent()}
                    </div>

                    <div className="mt-8 border-t pt-6 flex justify-between items-center flex-wrap gap-4">
                        <div className="relative">
                            <button
                                className="bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 hover:bg-yellow-600 active:scale-95"
                                onMouseEnter={() => setIsHintVisible(true)}
                                onMouseLeave={() => setIsHintVisible(false)}
                                onTouchStart={() => setIsHintVisible(true)}
                                onTouchEnd={() => setIsHintVisible(false)}
                            >
                                Gợi ý
                            </button>
                            <div className={`absolute bottom-full mb-2 w-max max-w-[90vw] sm:max-w-sm p-4 bg-yellow-100 border-l-4 border-yellow-500 rounded-xl shadow-lg transition-all duration-300 transform origin-bottom-left ${isHintVisible ? 'opacity-100 scale-100' : 'opacity-0 scale-90 pointer-events-none'}`}>
                                <p className="font-semibold text-yellow-800">Gợi ý:</p>
                                <p className="text-yellow-700">{currentQuestion.hint_vi || 'Không có gợi ý.'}</p>
                            </div>
                        </div>
                        
                        <button onClick={handleNext} disabled={!isAnswered} className="flex-grow py-3 px-4 bg-blue-500 text-white font-extrabold text-xl rounded-xl shadow-xl transition duration-300 hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed active:scale-98">
                            {currentQuestionIndex === totalQuestions - 1 ? 'Hoàn thành' : 'Câu tiếp theo'}
                        </button>
                    </div>

                    {isAnswered && (
                        <RationaleBox question={currentQuestion} isCorrect={isCorrect} submittedAnswer={submittedAnswer} />
                    )}
                </div>
            );
        };
        
        // --- Component: App.tsx ---
        const App = () => {
            const [gameState, setGameState] = React.useState('start');
            const [playerName, setPlayerName] = React.useState('');
            const [score, setScore] = React.useState(0);
            const [shuffledQuestions, setShuffledQuestions] = React.useState([]);
            const [incorrectAnswers, setIncorrectAnswers] = React.useState([]);
            const testName = "BỘ ĐỀ ÔN IOE K4 SỐ: 01.1";

            React.useEffect(() => {
                const array = [...questions];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
            }, []);

            const handleStartQuiz = (name) => {
                setPlayerName(name);
                setScore(0);
                setIncorrectAnswers([]);
                setGameState('quiz');
            };

            const handleEndQuiz = (finalScore, mistakes) => {
                setScore(finalScore);
                setIncorrectAnswers(mistakes);
                setGameState('end');
            };
            
            const handleRestartQuiz = () => {
                 const array = [...questions];
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                setShuffledQuestions(array);
                setGameState('start');
            };

            const handleReview = () => {
                setGameState('review');
            };

             const handleBackToEndScreen = () => {
                setGameState('end');
            };

            const renderContent = () => {
                switch (gameState) {
                    case 'quiz':
                        return <QuizScreen 
                                    playerName={playerName} 
                                    onEnd={handleEndQuiz} 
                                    totalQuestions={shuffledQuestions.length}
                                    questionSet={shuffledQuestions}
                                    testName={testName}
                                />;
                    case 'end':
                        return <EndScreen 
                                    playerName={playerName} 
                                    score={score} 
                                    totalQuestions={shuffledQuestions.length}
                                    onRestart={handleRestartQuiz} 
                                    onReview={incorrectAnswers.length > 0 ? handleReview : null}
                                    testName={testName}
                                />;
                    case 'review':
                        return <ReviewScreen 
                                    incorrectAnswers={incorrectAnswers}
                                    onBack={handleBackToEndScreen}
                                    testName={testName}
                                />;
                    default:
                         return <StartScreen onStart={handleStartQuiz} totalQuestions={questions.length} testName={testName} />;
                }
            };

            return (
                <div className="p-4 sm:p-8 flex justify-center items-start min-h-screen">
                    <div className="w-full max-w-3xl bg-white rounded-xl shadow-2xl p-6 sm:p-8 md:p-10 border border-gray-100 min-h-[80vh]">
                        {renderContent()}
                    </div>
                </div>
            );
        };
        
        // --- Entry point from index.tsx ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
